{"version":3,"sources":["../../src/middlewares/auth.middleware.ts"],"sourcesContent":["import { NextFunction, Response } from 'express';\nimport { verify } from 'jsonwebtoken';\nimport { SECRET_KEY } from '@config';\nimport { HttpException } from '@exceptions/HttpException';\nimport { DataStoredInToken, RequestWithUser } from '@interfaces/auth.interface';\nimport userModel from '@models/users.model';\n\nconst authMiddleware = async (req: RequestWithUser, res: Response, next: NextFunction) => {\n  try {\n    const Authorization = req.cookies['Authorization'] || (req.header('Authorization') ? req.header('Authorization').split('Bearer ')[1] : null);\n    console.log('Authorization', Authorization);\n    if (Authorization) {\n      const secretKey: string = SECRET_KEY;\n      const verificationResponse = (await verify(Authorization, secretKey)) as DataStoredInToken;\n      const userId = verificationResponse._id;\n      console.log('userId', userId);\n      const findUser = await userModel.findById(userId);\n      console.log('findUser', findUser);\n\n      if (findUser) {\n        req.user = findUser;\n        next();\n      } else {\n        next(new HttpException(401, 'Wrong authentication token'));\n      }\n    } else {\n      next(new HttpException(404, 'Authentication token missing'));\n    }\n  } catch (error) {\n    next(new HttpException(401, 'Wrong authentication token'));\n  }\n};\n\nexport default authMiddleware;\n"],"names":["authMiddleware","req","res","next","Authorization","cookies","header","split","console","log","secretKey","SECRET_KEY","verificationResponse","verify","userId","_id","findUser","userModel","findById","user","HttpException","error"],"mappings":";;;;+BAiCA;;;eAAA;;;8BAhCuB;wBACI;+BACG;mEAER;;;;;;AAEtB,MAAMA,iBAAiB,OAAOC,KAAsBC,KAAeC;IACjE,IAAI;QACF,MAAMC,gBAAgBH,IAAII,OAAO,CAAC,gBAAgB,IAAKJ,CAAAA,IAAIK,MAAM,CAAC,mBAAmBL,IAAIK,MAAM,CAAC,iBAAiBC,KAAK,CAAC,UAAU,CAAC,EAAE,GAAG,IAAG;QAC1IC,QAAQC,GAAG,CAAC,iBAAiBL;QAC7B,IAAIA,eAAe;YACjB,MAAMM,YAAoBC,kBAAU;YACpC,MAAMC,uBAAwB,MAAMC,IAAAA,oBAAM,EAACT,eAAeM;YAC1D,MAAMI,SAASF,qBAAqBG,GAAG;YACvCP,QAAQC,GAAG,CAAC,UAAUK;YACtB,MAAME,WAAW,MAAMC,mBAAS,CAACC,QAAQ,CAACJ;YAC1CN,QAAQC,GAAG,CAAC,YAAYO;YAExB,IAAIA,UAAU;gBACZf,IAAIkB,IAAI,GAAGH;gBACXb;YACF,OAAO;gBACLA,KAAK,IAAIiB,4BAAa,CAAC,KAAK;YAC9B;QACF,OAAO;YACLjB,KAAK,IAAIiB,4BAAa,CAAC,KAAK;QAC9B;IACF,EAAE,OAAOC,OAAO;QACdlB,KAAK,IAAIiB,4BAAa,CAAC,KAAK;IAC9B;AACF;MAEA,WAAepB"}